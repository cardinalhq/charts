suite: test kafka topics configmap
values:
  - ../values.yaml
set:
  kafkaTopics.create: true
templates:
  - kafka-setup-configmap.yaml
tests:
  # Test ConfigMap creation with default structure
  - it: should create configmap with kafka topics configuration
    asserts:
      - isKind:
          of: ConfigMap
      - equal:
          path: metadata.name
          value: RELEASE-NAME-lakerunner-kafka-topics
      - exists:
          path: data["kafka_topics.yaml"]
      - isNotEmpty:
          path: data["kafka_topics.yaml"]

  # Test ConfigMap not created when create is false
  - it: should not create configmap when create is false
    set:
      kafkaTopics.create: false
    asserts:
      - hasDocuments:
          count: 0

  # Test that custom config is rendered in configmap
  - it: should render custom kafka topics config structure
    set:
      kafkaTopics.config:
        defaults:
          partitionCount: 8
          replicationFactor: 3
        topics:
          - name: test.topic.custom
            partitionCount: 12
    asserts:
      - isKind:
          of: ConfigMap
      - exists:
          path: data["kafka_topics.yaml"]
      - isNotEmpty:
          path: data["kafka_topics.yaml"]